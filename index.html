
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Eiffel Tower VR Scene</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  </head>
  <body>
    <a-scene>
      <a-camera
        id="camera"
        position="-6.5 1.6 21"
        wasd-controls="acceleration: 20"
        aabb-collider="objects: .collidable">
        <a-entity
          cursor="rayOrigin: mouse"
          raycaster="objects: .hoverable"
          position="0 0 -1"
          geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
          material="color: red; shader: flat">
        </a-entity>
      </a-camera>

      <!-- Environment -->
      <a-gltf-model
        src="https://cdn.glitch.global/628e1600-3177-4d17-ab74-7432cf0bcda8/low_poly_eiffel_tower.glb?v=1735896314497"
        position="0 0 1"
        scale="1 1 1">
      </a-gltf-model>

      <!-- Man walking -->
      <a-gltf-model
        src="https://cdn.glitch.global/628e1600-3177-4d17-ab74-7432cf0bcda8/passive_marker_man_walking.glb?v=1736122091492"
        position="0 1 -3"
        animation-mixer="clip: Run; loop: repeat; timeScale: 1;">
      </a-gltf-model>

      <!-- Elevator -->
      <a-gltf-model
        id="elevator"
        src="https://cdn.glitch.global/628e1600-3177-4d17-ab74-7432cf0bcda8/old_elevator%20(1).glb?v=1735935905371"
        position="0 1 2"
        scale="0.01 0.01 0.01">
      </a-gltf-model>

      <a-box id="elevator-collider"
        position="0 1.6 2"
        depth="1"
        height="1"
        width="1"
        opacity="0"
        visible="false">
      </a-box>

      <!-- Info Texts -->
      <a-text look-at="#camera"
              id="info1"
              value="The Eiffel Tower quickly became an iconic symbol of Paris and France, captivating visitors from around the world with its grandeur and offering breathtaking panoramic views of the city."
              position="-6 4 5" 
              visible="true" 
              align="center"
              geometry="primitive: plane; height: 2; width: 5;"
              material="shader: flat; side: double; transparent: true; opacity: 0.7; color: black;">
      </a-text>

      <a-text look-at="#camera"
              id="info2"
              value="Eiffel Tower stands 330 meters (1,083 feet) tall, making it the tallest structure in Paris."
              position="-10 2 13" 
              rotation="0 90 0"  
              visible="true" 
              align="center"
              geometry="primitive: plane; height: 2; width: 5;"
              material="shader: flat; side: double; transparent: true; opacity: 0.7; color: black;">
      </a-text>

      <div id="output"></div>

      <a-light type="ambient" color="#888" intensity="4"></a-light>
      <a-sky color="#ECECEC"></a-sky>
    </a-scene>

    <script>
      const elevator = document.querySelector("#elevator");
      const camera = document.querySelector("#camera");

      // Animation definitions
      const ascendAnimation3 = {
        property: "position",
        to: "0 10 2",
        dur: 2000,
        easing: "easeInOutQuad",
      };

      const ascendAnimationCamera3 = {
        property: "position",
        to: "0 10.6 2",
        dur: 2000,
        easing: "easeInOutQuad",
      };

      const ascendAnimation2 = {
        property: "position",
        to: "0 5 2",
        dur: 2000,
        easing: "easeInOutQuad",
      };

      const ascendAnimationCamera2 = {
        property: "position",
        to: "0 5.6 2",
        dur: 2000,
        easing: "easeInOutQuad",
      };

      const descendAnimation = {
        property: "position",
        to: "0 1 2",
        dur: 2000,
        easing: "easeInOutQuad",
      };

      const descendAnimationCamera = {
        property: "position",
        to: "0 1.6 2",
        dur: 2000,
        easing: "easeInOutQuad",
      };

      // Move camera forward
      function moveCameraForward() {
        let position = camera.getAttribute("position");
        let direction = new THREE.Vector3();
        camera.object3D.getWorldDirection(direction);
        direction.multiplyScalar(0.15);
        position.x -= direction.x;
        position.z -= direction.z;
        camera.setAttribute("position", position);
      }

      // Variable to control walking
      let walkingInterval = null;

      // Keydown events for animations
      window.addEventListener("keydown", (event) => {
        if (event.key === "2") {
          elevator.setAttribute("animation", ascendAnimation2);
          camera.setAttribute("animation", ascendAnimationCamera2);
        } else if (event.key === "1") {
          elevator.setAttribute("animation", descendAnimation);
          camera.setAttribute("animation", descendAnimationCamera);
        } else if (event.key === "3") {
          elevator.setAttribute("animation", ascendAnimation3);
          camera.setAttribute("animation", ascendAnimationCamera3);
        }
      });

      function jumpCamera() {
        let position = camera.getAttribute("position");
        let initialY = position.y;
        let jumpHeight = 1;
        let jumpDuration = 500;

        $(camera).animate(
          { y: initialY + jumpHeight },
          {
            duration: jumpDuration / 2,
            step: function (now) {
              camera.setAttribute("position", { x: position.x, y: now, z: position.z });
            },
            complete: function () {
              $(camera).animate(
                { y: initialY },
                {
                  duration: jumpDuration / 2,
                  step: function (now) {
                    camera.setAttribute("position", { x: position.x, y: now, z: position.z });
                  },
                }
              );
            },
          }
        );
      }

      $(document).keydown((event) => {
        if (event.code === "Space") {
          jumpCamera();
        }
      });

      // Speech recognition
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (SpeechRecognition) {
        const recognition = new Sp
        eechRecognition();
        recognition.lang = "en-US";
        recognition.interimResults = true;
        recognition.continuous = true;

        const output = document.getElementById("output");
        let clearTimeoutId;

        recognition.onresult = (event) => {
          let transcript = "";
          for (let i = event.resultIndex; i < event.results.length; i++) {
            transcript += event.results[i][0].transcript;
          }
          output.innerText = transcript;

          if (transcript.includes("jump")) {
            jumpCamera();
          } else if (transcript.includes("1") || transcript.includes("one")) {
            elevator.setAttribute("animation", descendAnimation);
            camera.setAttribute("animation", descendAnimationCamera);
          } else if (transcript.includes("2") || transcript.includes("two")) {
            elevator.setAttribute("animation", ascendAnimation2);
            camera.setAttribute("animation", ascendAnimationCamera2);
          } else if (transcript.includes("3") || transcript.includes("three")) {
            elevator.setAttribute("animation", ascendAnimation3);
            camera.setAttribute("animation", ascendAnimationCamera3);
          } else if (transcript.includes("walk")) {
            if (!walkingInterval) {
              walkingInterval = setInterval(moveCameraForward, 100);
              console.log("Walking started");
            }
          } else if (transcript.includes("stop")) {
            if (walkingInterval) {
              clearInterval(walkingInterval);
              walkingInterval = null;
              console.log("Walking stopped");
            }
          }

          clearTimeout(clearTimeoutId);
          clearTimeoutId = setTimeout(() => {
            output.innerText = "";
          }, 500);
        };

        recognition.onerror = (event) => {
          console.error("Speech recognition error:", event.error);
          alert(`Error: ${event.error}`);
        };

        recognition.start();

        recognition.onend = () => {
          recognition.start();
        };
      } else {
        alert("Your browser does not support the Web Speech API. Please use a modern browser.");
      }
    </script>
  </body>
</html>
