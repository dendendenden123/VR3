<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const player = document.querySelector("#player");
        let isWalking = false;
        let walkSpeed = 0.05;

        // Request permission for device orientation on iOS
        if (typeof DeviceMotionEvent !== "undefined" && typeof DeviceMotionEvent.requestPermission === "function") {
          DeviceMotionEvent.requestPermission()
            .then((permissionState) => {
              if (permissionState === "granted") {
                startWalking();
              }
            })
            .catch(console.error);
        } else {
          startWalking();
        }

        function startWalking() {
          window.addEventListener("deviceorientation", (event) => {
            const tiltForward = event.beta; // Forward tilt angle
            const tiltSide = event.gamma; // Side tilt angle

            // Debug logs (remove for production)
            console.log(`Tilt Forward (beta): ${tiltForward}`);
            console.log(`Tilt Side (gamma): ${tiltSide}`);

            // Determine if walking forward based on tilt range
            isWalking = tiltForward > 15 && tiltForward < 70;

            // Adjust walking speed (optional)
            if (tiltForward > 30 && tiltForward < 60) {
              walkSpeed = 0.1; // Faster speed for steeper tilt
            } else {
              walkSpeed = 0.05; // Default speed
            }
          });

          // Update player's position based on walking
          function updatePosition() {
            if (isWalking) {
              const position = player.getAttribute("position");
              const rotation = player.getAttribute("rotation");

              // Calculate movement direction based on rotation
              const radianRotationY = (rotation.y * Math.PI) / 180; // Convert to radians
              position.x -= walkSpeed * Math.sin(radianRotationY);
              position.z -= walkSpeed * Math.cos(radianRotationY);

              player.setAttribute("position", position);
            }

            requestAnimationFrame(updatePosition);
          }

          updatePosition();
        }
      });
    </script>
  </head>
  <body>
    <a-scene
      renderer="logarithmicDepthBuffer: true; xr: true"
      xr-mode="immersive-ar"
      webxr="optionalFeatures: hit-test; requiredFeatures: local-floor">
      <!-- Player -->
      <a-entity id="player" position="0 1.6 0" camera look-controls></a-entity>

      <!-- Ground -->
      <a-plane position="0 0 -4" rotation="-90 0 0" width="50" height="50" color="#7BC8A4"></a-plane>

      <!-- Example Objects -->
      <a-box position="-1 0.5 -3" rotation="0 45 0" color="#4CC3D9"></a-box>
      <a-sphere position="2 1 -5" radius="1.25" color="#EF2D5E"></a-sphere>
      <a-cylinder position="1 0.75 -2" radius="0.5" height="1.5" color="#FFC65D"></a-cylinder>
    </a-scene>
  </body>
</html>
